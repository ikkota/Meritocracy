<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教育社会学特講 LMS 2025 | J.F. Oberlin Univ.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Shippori+Mincho:wght@400;600&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                        serif: ['"Shippori Mincho"', 'serif'],
                    },
                    colors: {
                        oberlin: {
                            red: '#8B2635',
                            dark: '#1A202C',
                            light: '#F7FAFC',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        .term-link { color: #2563EB; border-bottom: 1px dotted #2563EB; cursor: pointer; font-weight: 500; transition: all 0.2s; }
        .term-link:hover { background-color: #EFF6FF; color: #1E40AF; }
        .page-section { display: none; animation: fadeIn 0.5s ease; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hook-box { background-color: #fff; border-left: 6px solid #8B2635; padding: 1.5rem; margin-bottom: 2.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        
        /* Login Overlay */
        #login-overlay { position: fixed; inset: 0; background: #1A202C; z-index: 100; display: flex; align-items: center; justify-content: center; flex-direction: column; color: white; }
        .hidden { display: none !important; }
        
        /* Toast Notification */
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 4px; padding: 16px; position: fixed; z-index: 1; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 14px; }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans h-screen flex overflow-hidden">

    <div id="login-overlay">
        <div class="text-center max-w-md px-6">
            <p class="text-oberlin-red font-bold tracking-widest uppercase text-sm mb-4">J.F. Oberlin University</p>
            <h1 class="text-4xl font-serif font-bold mb-6">教育社会学特講 LMS</h1>
            <p class="mb-8 text-gray-400 text-sm">受講記録を保存するため、Googleアカウントでの認証が必要です。</p>
            <button id="google-login-btn" class="bg-white text-gray-800 px-8 py-3 rounded-full font-bold hover:bg-gray-200 transition flex items-center justify-center w-full">
                <i class="fab fa-google mr-3 text-oberlin-red"></i> Googleアカウントでログイン
            </button>
        </div>
    </div>

    <div id="toast">Saved successfully</div>

    <aside class="w-64 bg-oberlin-dark text-white flex-shrink-0 flex flex-col shadow-xl z-10">
        <div class="p-6 border-b border-gray-700">
            <h1 class="font-serif font-bold text-xl tracking-wider">Sociology of<br>Education</h1>
            <div class="mt-4 flex items-center">
                <img id="user-avatar" src="" class="w-8 h-8 rounded-full mr-3 bg-gray-600 hidden">
                <span id="user-name" class="text-xs text-gray-300 truncate">Guest</span>
            </div>
        </div>
        <nav class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-1">
                <li><button onclick="navTo('home')" class="nav-btn w-full text-left px-6 py-3 hover:bg-gray-700 transition border-l-4 border-transparent" id="btn-home"><i class="fas fa-home w-6"></i> Top / Introduction</button></li>
                <li class="pt-4 pb-2 px-6 text-xs font-bold text-gray-500 uppercase">Syllabus & Tasks</li>
                <li><button onclick="navTo('week1')" class="nav-btn w-full text-left px-6 py-3 hover:bg-gray-700 transition border-l-4 border-transparent" id="btn-week1"><i class="fas fa-layer-group w-6"></i> Week 1: Theory <i class="fas fa-check text-green-500 ml-2 hidden" id="status-week1"></i></button></li>
                <li><button onclick="navTo('week2')" class="nav-btn w-full text-left px-6 py-3 hover:bg-gray-700 transition border-l-4 border-transparent" id="btn-week2"><i class="fas fa-chart-pie w-6"></i> Week 2: Application <i class="fas fa-check text-green-500 ml-2 hidden" id="status-week2"></i></button></li>
                <li><button onclick="navTo('week3')" class="nav-btn w-full text-left px-6 py-3 hover:bg-gray-700 transition border-l-4 border-transparent" id="btn-week3"><i class="fas fa-fist-raised w-6"></i> Week 3: Critique <i class="fas fa-check text-green-500 ml-2 hidden" id="status-week3"></i></button></li>
                <li class="pt-4 pb-2 px-6 text-xs font-bold text-gray-500 uppercase">Community</li>
                <li><button onclick="navTo('forum')" class="nav-btn w-full text-left px-6 py-3 hover:bg-gray-700 transition border-l-4 border-transparent" id="btn-forum"><i class="fas fa-comments w-6"></i> Discussion Board</button></li>
            </ul>
        </nav>
        <button id="logout-btn" class="p-4 text-xs text-gray-500 hover:text-white text-center border-t border-gray-700">ログアウト</button>
    </aside>

    <main class="flex-1 overflow-y-auto relative scroll-smooth bg-white">

        <div id="home" class="page-section active">
            <div class="max-w-4xl mx-auto px-8 py-16">
                <div class="mb-12 text-center">
                    <span class="text-oberlin-red font-bold tracking-widest uppercase text-sm">Course Overview</span>
                    <h2 class="text-4xl font-serif font-bold mt-4 mb-6 text-gray-900">教育格差、メリトクラシー、<br>そして社会正義</h2>
                    <p class="text-xl text-gray-600 leading-relaxed max-w-2xl mx-auto">
                        本講義は、現代社会の亀裂である「教育格差」を、対立する理論的視座から解剖する集中講義である。<br>
                        各週の最後に「課題」がある。必ず提出すること。
                    </p>
                </div>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-gray-50 p-6 rounded-xl border border-gray-200 cursor-pointer hover:shadow-md transition" onclick="navTo('week1')">
                        <h3 class="font-bold text-lg text-blue-800 mb-2">Week 1</h3>
                        <p class="text-sm text-gray-600">人的資本論 vs 再生産論。</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-xl border border-gray-200 cursor-pointer hover:shadow-md transition" onclick="navTo('week2')">
                        <h3 class="font-bold text-lg text-yellow-700 mb-2">Week 2</h3>
                        <p class="text-sm text-gray-600">市場原理とテストの政治学。</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-xl border border-gray-200 cursor-pointer hover:shadow-md transition" onclick="navTo('week3')">
                        <h3 class="font-bold text-lg text-purple-800 mb-2">Week 3</h3>
                        <p class="text-sm text-gray-600">脱植民地化と教育の未来。</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="week1" class="page-section">
            <header class="bg-blue-50 px-8 py-12 border-b border-blue-100">
                <div class="max-w-4xl mx-auto">
                    <span class="bg-blue-600 text-white text-xs font-bold px-3 py-1 rounded-full">Week 1</span>
                    <h2 class="text-3xl font-serif font-bold mt-4 text-gray-900">メリトクラシーの光と影</h2>
                </div>
            </header>
            <div class="max-w-4xl mx-auto px-8 py-12">
                <div class="hook-box">
                    <div class="flex items-center mb-2 text-oberlin-red font-bold"><i class="fas fa-question-circle mr-2"></i> Key Question</div>
                    <p class="text-xl font-serif font-medium text-gray-800">学業の成功は、本当に「個人の努力」の賜物なのか？</p>
                </div>

                <section class="mb-12">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4"><span class="text-blue-500 mr-2">1.1</span> 人的資本理論と再生産</h3>
                    <p class="text-gray-700 leading-8 mb-4">
                        <span class="term-link" onclick="openGlossary('hct')">人的資本理論</span>は教育を投資と捉えるが、ブルデューは<span class="term-link" onclick="openGlossary('cultural_capital')">文化資本</span>の概念を用い、学校が上流階級の文化を評価基準とすることで、格差を<span class="term-link" onclick="openGlossary('reproduction')">再生産</span>していると批判した。
                    </p>
                </section>

                <div class="bg-blue-50 p-6 rounded-xl border border-blue-200 mt-12">
                    <h4 class="font-bold text-blue-900 mb-2"><i class="fas fa-pen-nib mr-2"></i>Week 1 課題: 理論の適用</h4>
                    <p class="text-sm text-gray-700 mb-4">
                        あなた自身の大学受験やこれまでの学習経験を振り返り、「人的資本理論」と「再生産理論（文化資本など）」のどちらが自分の経験をよりよく説明できるか考察しなさい。（200字〜400字程度）
                    </p>
                    <textarea id="assign-week1" class="w-full border border-gray-300 rounded p-3 text-sm h-32 focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="ここに回答を入力..."></textarea>
                    <div class="mt-3 text-right">
                        <button onclick="submitAssignment('week1')" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 text-sm font-bold transition">課題を提出する</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="week2" class="page-section">
            <header class="bg-yellow-50 px-8 py-12 border-b border-yellow-100">
                <div class="max-w-4xl mx-auto">
                    <span class="bg-yellow-600 text-white text-xs font-bold px-3 py-1 rounded-full">Week 2</span>
                    <h2 class="text-3xl font-serif font-bold mt-4 text-gray-900">市場とテストの政治学</h2>
                </div>
            </header>
            <div class="max-w-4xl mx-auto px-8 py-12">
                <div class="hook-box">
                    <div class="flex items-center mb-2 text-oberlin-red font-bold"><i class="fas fa-question-circle mr-2"></i> Key Question</div>
                    <p class="text-xl font-serif font-medium text-gray-800">「選択の自由」や「公正なテスト」は、本当に格差を是正するのか？</p>
                </div>

                <section class="mb-12">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">選択と排除のメカニズム</h3>
                    <p class="text-gray-700 leading-8 mb-4">
                        <span class="term-link" onclick="openGlossary('school_choice')">学校選択制</span>は競争を促すが、<span class="term-link" onclick="openGlossary('info_asymmetry')">情報の非対称性</span>により、結果として<span class="term-link" onclick="openGlossary('segregation')">分離・隔離</span>が進む。また、<span class="term-link" onclick="openGlossary('standardized_test')">標準化テスト</span>には、<span class="term-link" onclick="openGlossary('stereotype_threat')">ステレオタイプ脅威</span>などのバイアスが潜む。
                    </p>
                </section>

                <div class="bg-yellow-50 p-6 rounded-xl border border-yellow-200 mt-12">
                    <h4 class="font-bold text-yellow-900 mb-2"><i class="fas fa-pen-nib mr-2"></i>Week 2 課題: 政策論争</h4>
                    <p class="text-sm text-gray-700 mb-4">
                        日本においても「学校選択制」の導入や拡大を求める声がある。本講義で学んだ「分離・隔離（Segregation）」のリスクを踏まえ、あなたは選択制の拡大に賛成か反対か、理由とともに述べよ。
                    </p>
                    <textarea id="assign-week2" class="w-full border border-gray-300 rounded p-3 text-sm h-32 focus:ring-2 focus:ring-yellow-500 focus:outline-none" placeholder="ここに回答を入力..."></textarea>
                    <div class="mt-3 text-right">
                        <button onclick="submitAssignment('week2')" class="bg-yellow-600 text-white px-6 py-2 rounded hover:bg-yellow-700 text-sm font-bold transition">課題を提出する</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="week3" class="page-section">
            <header class="bg-purple-50 px-8 py-12 border-b border-purple-100">
                <div class="max-w-4xl mx-auto">
                    <span class="bg-purple-600 text-white text-xs font-bold px-3 py-1 rounded-full">Week 3</span>
                    <h2 class="text-3xl font-serif font-bold mt-4 text-gray-900">改革を超えて</h2>
                </div>
            </header>
            <div class="max-w-4xl mx-auto px-8 py-12">
                <div class="hook-box">
                    <div class="flex items-center mb-2 text-oberlin-red font-bold"><i class="fas fa-question-circle mr-2"></i> Key Question</div>
                    <p class="text-xl font-serif font-medium text-gray-800">君たちが学ぶ「正解」は、誰によって決められたのか？</p>
                </div>

                <section class="mb-12">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">脱植民地化と未来</h3>
                    <p class="text-gray-700 leading-8 mb-4">
                        <span class="term-link" onclick="openGlossary('decolonization')">脱植民地化</span>は知の権力構造を問う。<span class="term-link" onclick="openGlossary('abolitionist')">アボリショニスト・ティーチング</span>は、サバイバルではなく自由を求める。
                    </p>
                </section>

                <div class="bg-purple-50 p-6 rounded-xl border border-purple-200 mt-12">
                    <h4 class="font-bold text-purple-900 mb-2"><i class="fas fa-pen-nib mr-2"></i>Week 3 課題: カリキュラムの再構想</h4>
                    <p class="text-sm text-gray-700 mb-4">
                        もしあなたが大学のカリキュラムを自由に編成できるとしたら、「脱植民地化」の視点を取り入れて、どのような新しい授業科目を作りますか？具体的な授業名と内容を提案してください。
                    </p>
                    <textarea id="assign-week3" class="w-full border border-gray-300 rounded p-3 text-sm h-32 focus:ring-2 focus:ring-purple-500 focus:outline-none" placeholder="ここに回答を入力..."></textarea>
                    <div class="mt-3 text-right">
                        <button onclick="submitAssignment('week3')" class="bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 text-sm font-bold transition">課題を提出する</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="forum" class="page-section">
            <header class="bg-gray-800 px-8 py-12 text-white">
                <div class="max-w-4xl mx-auto">
                    <span class="bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full">Community</span>
                    <h2 class="text-3xl font-serif font-bold mt-4">Discussion Board</h2>
                    <p class="text-gray-300 mt-2">講義の感想、質問、反論などを自由に書き込んでください。</p>
                </div>
            </header>
            <div class="max-w-4xl mx-auto px-8 py-12">
                <div class="bg-white p-4 rounded shadow-sm border border-gray-200 mb-8">
                    <textarea id="forum-input" class="w-full border border-gray-300 p-3 rounded mb-2 focus:outline-none focus:border-green-500" rows="3" placeholder="意見を投稿する..."></textarea>
                    <div class="text-right">
                        <button onclick="postComment()" class="bg-green-600 text-white px-6 py-2 rounded font-bold hover:bg-green-700 transition">投稿</button>
                    </div>
                </div>
                <div id="posts-container" class="space-y-4">
                    <p class="text-center text-gray-400">読み込み中...</p>
                </div>
            </div>
        </div>

    </main>

    <div id="glossary-drawer" class="fixed inset-y-0 right-0 w-80 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out z-50 flex flex-col border-l border-gray-200">
        <div class="p-4 bg-gray-50 border-b border-gray-200 flex justify-between items-center">
            <h3 class="font-bold text-gray-700"><i class="fas fa-book-reader mr-2"></i>用語解説</h3>
            <button onclick="closeGlossary()" class="text-gray-400 hover:text-gray-700"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div class="p-6 flex-1 overflow-y-auto" id="glossary-content"></div>
    </div>

    <script type="module">
        // Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, addDoc, collection, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyCg9DzLOfhpraxj7l5Ecsx99NGFdG5YcTg",
            authDomain: "meritocracy-ceae7.firebaseapp.com",
            projectId: "meritocracy-ceae7",
            storageBucket: "meritocracy-ceae7.firebasestorage.app",
            messagingSenderId: "130432308656",
            appId: "1:130432308656:web:14bcc135d9f63e05107275",
            measurementId: "G-HFWTB2CMN2"
        };

        // --- Init ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let currentUser = null;

        // Auth Logic
        const loginBtn = document.getElementById('google-login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const loginOverlay = document.getElementById('login-overlay');
        const avatar = document.getElementById('user-avatar');
        const username = document.getElementById('user-name');

        loginBtn.addEventListener('click', () => {
            const provider = new GoogleAuthProvider();
            signInWithPopup(auth, provider).catch(e => alert("Login Failed: " + e.message));
        });

        logoutBtn.addEventListener('click', () => signOut(auth));

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                loginOverlay.classList.add('hidden');
                avatar.src = user.photoURL;
                avatar.classList.remove('hidden');
                username.textContent = user.displayName;
                
                // Load Data
                loadUserAssignments(user.uid);
                loadForum();
            } else {
                loginOverlay.classList.remove('hidden');
                currentUser = null;
            }
        });

        // UI Functions (Global scope)
        window.navTo = (pageId) => {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(el => {
                el.classList.remove('bg-gray-700', 'border-white');
                el.classList.add('border-transparent');
            });
            const btn = document.getElementById('btn-' + pageId);
            if(btn) {
                btn.classList.remove('border-transparent');
                btn.classList.add('bg-gray-700', 'border-white');
            }
        };

        // --- Assignment Logic ---
        window.submitAssignment = async (weekId) => {
            if(!currentUser) return;
            const text = document.getElementById('assign-' + weekId).value;
            if(!text.trim()) return alert("回答を入力してください。");

            try {
                // Save to Firestore under users/{uid}
                await setDoc(doc(db, "users", currentUser.uid), {
                    name: currentUser.displayName,
                    email: currentUser.email,
                    [weekId + "_submission"]: text,
                    [weekId + "_submittedAt"]: serverTimestamp()
                }, { merge: true });

                showToast("課題を提出しました！");
                document.getElementById('status-' + weekId).classList.remove('hidden');
            } catch(e) {
                console.error(e);
                alert("送信エラー: Firebaseコンソールのルール設定を確認してください。");
            }
        };

        async function loadUserAssignments(uid) {
            const snap = await getDoc(doc(db, "users", uid));
            if(snap.exists()) {
                const data = snap.data();
                ['week1', 'week2', 'week3'].forEach(week => {
                    if(data[week + "_submission"]) {
                        document.getElementById('assign-' + week).value = data[week + "_submission"];
                        document.getElementById('status-' + week).classList.remove('hidden');
                    }
                });
            }
        }

        // --- Forum Logic ---
        window.postComment = async () => {
            const text = document.getElementById('forum-input').value;
            if(!text.trim()) return;
            
            try {
                await addDoc(collection(db, "posts"), {
                    text: text,
                    uid: currentUser.uid,
                    name: currentUser.displayName,
                    photo: currentUser.photoURL,
                    createdAt: serverTimestamp()
                });
                document.getElementById('forum-input').value = "";
            } catch(e) {
                console.error(e);
                alert("投稿エラー: データベースの書き込み権限がありません。");
            }
        };

        function loadForum() {
            const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
            onSnapshot(q, (snapshot) => {
                const container = document.getElementById('posts-container');
                container.innerHTML = "";
                snapshot.forEach(doc => {
                    const post = doc.data();
                    // 日付処理: post.createdAtがnullの場合（書き込み直後）の対策
                    let dateStr = "Now";
                    if (post.createdAt && post.createdAt.toDate) {
                        dateStr = new Date(post.createdAt.toDate()).toLocaleString('ja-JP');
                    }

                    const html = `
                        <div class="bg-white p-4 rounded border border-gray-200 flex gap-3 mb-3">
                            <img src="${post.photo}" class="w-10 h-10 rounded-full">
                            <div class="flex-1">
                                <div class="flex justify-between items-baseline">
                                    <span class="font-bold text-sm text-gray-800">${post.name}</span>
                                    <span class="text-xs text-gray-400">${dateStr}</span>
                                </div>
                                <p class="text-gray-700 mt-1 text-sm leading-relaxed">${post.text}</p>
                            </div>
                        </div>`;
                    container.innerHTML += html;
                });
            });
        }

        // --- Glossary & Toast Logic ---
        const glossaryData = {
            'hct': { title: '人的資本理論 (Human Capital Theory)', desc: '教育を「消費」ではなく「投資」として捉える経済理論。' },
            'cultural_capital': { title: '文化資本 (Cultural Capital)', desc: 'Pierre Bourdieuの概念。家庭で身につく言葉遣い、趣味、教養など。' },
            'reproduction': { title: '社会的再生産', desc: '教育が階層移動を促すのではなく、既存の不平等を固定化する機能。' },
            'school_choice': { title: '学校選択制', desc: '親が公立学校を選べる制度。競争原理の導入。' },
            'info_asymmetry': { title: '情報の非対称性', desc: '情報の持ち主によって有利不利が生まれる状態。' },
            'segregation': { title: '分離・隔離', desc: '特定の人種や階層が特定の学校に固まること。' },
            'standardized_test': { title: '標準化テスト', desc: '画一的な基準で行われる学力テスト。' },
            'stereotype_threat': { title: 'ステレオタイプ脅威', desc: '偏見を意識することで能力が低下する心理現象。' },
            'decolonization': { title: '脱植民地化', desc: '西洋中心的な知のあり方を問い直す運動。' },
            'abolitionist': { title: 'アボリショニスト', desc: '抑圧的な構造の廃絶を目指す教育実践。' }
        };

        window.openGlossary = (key) => {
            const data = glossaryData[key];
            if(data) {
                document.getElementById('glossary-content').innerHTML = `<h4 class="font-bold text-blue-800 mb-2">${data.title}</h4><p class="text-sm leading-6">${data.desc}</p>`;
                document.getElementById('glossary-drawer').classList.remove('translate-x-full');
            }
        }
        window.closeGlossary = () => document.getElementById('glossary-drawer').classList.add('translate-x-full');

        function showToast(msg) {
            const t = document.getElementById("toast");
            t.innerText = msg;
            t.className = "show";
            setTimeout(() => { t.className = t.className.replace("show", ""); }, 3000);
        }
        
        // Init View
        navTo('home');
    </script>
</body>
</html>
